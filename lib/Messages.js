/*
 * Copyright (C) 2009-2019 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["jquery.sap.global","sap/m/MessagePopover","sap/m/MessageItem","sap/m/MessageToast","sap/ui/core/message/Message"],function(q,M,a,b,c){"use strict";return{getMessageManager:function(){return sap.ui.getCore().getMessageManager();},getMessageModel:function(){return this.getMessageManager().getMessageModel();},getMessages:function(){return this.getMessageModel().getData();},getMessagePopover:function(){if(!this.messagePopover){this.messagePopover=new M({items:{path:"message>/",template:new a({type:"{message>type}",title:"{message>message}",longtextUrl:"{message>descriptionUrl}"})}});this.messagePopover.setModel(this.getMessageModel(),"message");}return this.messagePopover;},isPopoverOpen:function(){return this.messagePopover&&this.getMessagePopover().isOpen();},ensurePopoverIsOpen:function(d){var p=this.getMessagePopover();if(!p.isOpen()){p.openBy(d);}},closePopover:function(){var p=this.getMessagePopover();if(p.isOpen()){p.close();}},getProperty:function(t,p){var v=typeof t==="object"&&t.hasOwnProperty(p)?t[p]:null;return v?v:null;},messageFromResponseText:function(e){var m=null;var t=this.getProperty(e,"responseText");var w=null;if(t){try{w=JSON.parse(t);m=w.error.message.value;}catch(d){m=null;}}return m;},messageFromStatus:function(e){var m=null;var s=this.getProperty(e,"statusText");if(s){m=this.getProperty(e,"statusCode")+" - "+s;}return m;},messageFromMessage:function(e){var m=this.getProperty(e,"message");return m?m:e;},getErrorMessage:function(e){var m=[this.messageFromResponseText.bind(this),this.messageFromStatus.bind(this),this.messageFromMessage.bind(this)];var i;var d;for(i=0;i<m.length;i++){d=m[i](e);if(d){break;}}return d?d:"";},getErrorDescriptionUrl:function(e){var d=null;var t=this.getProperty(e,"responseText");var w=null;if(t){try{w=JSON.parse(t);d=w.error.innererror.errordetails[0].longtext_url;}catch(f){d=null;}}return d;},getMessageIndicator:function(){return this.temporaryMessageIndicator?this.temporaryMessageIndicator:this.messageIndicator;},setMessageIndicator:function(m){this.messageIndicator=m;this.useCustomPopover();},useCustomPopover:function(){var p;var m=this.getMessagePopover();var d=this.getMessageIndicator();var e=d["mEventRegistry"];if(e&&e.press){p=e.press[0];d.detachPress(p.fFunction,p.oListener);d.attachPress(function(){m.toggle.call(m,d);},this);}},setTemporaryMessagesIndicator:function(m){this.temporaryMessageIndicator=m;},toggleMessagePopover:function(d){if(this.isPopoverOpen()){this.closePopover();}else{this.ensurePopoverIsOpen(d);}},addErrorMessage:function(e){var i=this.getMessageIndicator();var d=this.getErrorMessage(e).replace(/&/g,"\"");if(!this.isDuplicateMessage(d)){this.getMessageManager().addMessages(new c({type:sap.ui.core.MessageType.Error,message:d,descriptionUrl:this.getErrorDescriptionUrl(e),processor:this.getMessageModel()}));}if(i){q.sap.delayedCall(0,this,this.ensurePopoverIsOpen,[i]);}},isDuplicateMessage:function(m){return this.getMessageModel().getData().some(function(i){return i.getMessage()===m;});},addSuccessMessage:function(m){var i=this.getMessageIndicator();this.getMessageManager().addMessages(new c({type:sap.ui.core.MessageType.Success,message:m,processor:this.getMessageModel()}));if(i){q.sap.delayedCall(0,this,this.ensurePopoverIsOpen,[i]);}},clearMessages:function(){this.getMessageManager().removeAllMessages();},showMessageToast:function(m){b.show(m);}};});

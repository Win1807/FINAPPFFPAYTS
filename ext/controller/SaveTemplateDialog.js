/*
 * Copyright (C) 2009-2019 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/ui/base/Object","sap/ui/core/ValueState","fin/ap/process/payments/lib/Constants","fin/ap/process/payments/model/additionalModels","sap/ui/Global"],function(P,V,C,a,U){"use strict";var T="VARIANT_NAME_EXISTS";var I="INPUT_REQUIRED";var S="fin.ap.process.payments.ext.fragment.SaveTemplateDialog";var b=P.extend("fin.ap.process.payments.ext.controller.SaveTemplateDialog",{constructor:function(v){var f;this.view=function(){return v;};f=U.xmlfragment(this.view().getId(),S,this);this.fragment=function(){return f;};this.view().addDependent(this.fragment());this.view().setModel(a.saveTemplateModel(),"saveTemplate");}});b.prototype.showDialog=function(t){this.templateNames=t;this.fragment().open();};b.prototype.toggleSaveOverwrite=function(i){this.getModel("saveTemplate").setProperty("/buttons/save",!i);this.getModel("saveTemplate").setProperty("/buttons/overwrite",i);};b.prototype.onSaveTemplatePress=function(){if(this.validateInputFields()){this.saveTemplate(false);}};b.prototype.onOverwriteTemplatePress=function(){if(this.validateInputFields()){this.saveTemplate(true);}};b.prototype.validateInputFields=function(){var i;var c;return C.SAVETEMPLATE_INPUT_IDS.every(function(d){i=this.view().byId(d);c=(d===C.SAVETEMPLATE_INPUT_IDS[0])?this.checkName(i.getValue()):false;return this.validateInput(i,c);}.bind(this));};b.prototype.saveTemplate=function(i){var n=this.view().byId("templateName").getValue();var c=this.view().byId("templateDescription").getValue();var d=this.getProperty("DraftUUID");return this.save(n,c,d,i).then(function(){this.closeDialog();}.bind(this));};b.prototype.getProperty=function(p){var c=this.view().getBindingContext();return c.getProperty(p);};b.prototype.save=function(t,c,d,i){return new Promise(function(r,e){this.getModel().callFunction("/saveTemplate",{method:"POST",urlParameters:{DRAFTUUID:d,TemplateDesc:c,TemplateID:t,IsOverwriteMode:i},success:function(f){r();}});}.bind(this));};b.prototype.onTemplNameChange=function(e){var n=e.getParameter("newValue");var i=this.checkName(n);this.validateInput(e.getSource(),i);};b.prototype.onTemplDescriptionChange=function(e){this.validateInput(e.getSource(),false);};b.prototype.validateInput=function(i,c){var d=i.getValue()==="";var v=this.getValueState(d,c);var e=this.getResourceBundle().getText(v.text,i.getLabels()[0].getText());i.setValueState(v.state).setValueStateText(e);return v.state!==V.Error;};b.prototype.getValueState=function(i,c){var v={state:V.None,text:""};if(i){v.state=V.Error;v.text=I;}else if(c){v.state=V.Warning;v.text=T;}return v;};b.prototype.checkName=function(n){var i=this.templateNames.some(function(t){return t===n.toUpperCase();});this.toggleSaveOverwrite(i);return i;};b.prototype.onSaveTemplateCancelPress=function(){this.closeDialog();};b.prototype.getModel=function(i){return this.view().getModel(i);};b.prototype.getResourceBundle=function(){return this.getModel("i18n").getResourceBundle();};b.prototype.closeDialog=function(){this.fragment().close();};return b;});

/*
 * Copyright (C) 2009-2019 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/ui/base/Object","sap/ui/Global","fin/ap/process/payments/model/additionalModels","sap/ui/model/FilterOperator"],function(P,U,a,F){"use strict";var D="fin.ap.process.payments.ext.fragment.DuplicateCheckDialog";var b=P.extend("fin.ap.process.payments.ext.controller.DuplicateCheckDialog",{constructor:function(v,c){var f;this.view=function(){return v;};this.appMode=function(){return c;};f=U.xmlfragment(this.view().getId(),D,this);this.fragment=function(){return f;};this.view().addDependent(this.fragment());}});b.prototype.duplicateCheckBtnPress=function(){this.prepareDuplicateList();this.showDialog();};b.prototype.prepareDuplicateList=function(){var d=a.duplicateCheckModel();var f=this.getVisibleFieldsFromSmartFilterBar();var c=this.createFilterFromFields(f);d.setData({items:c});this.view().setModel(d,"DuplicateCheck");};b.prototype.getVisibleFieldsFromSmartFilterBar=function(){var s=this.view().byId("listReportFilter");var v=s.fetchVariant();var f=v.filterbar.filter(function(i){return i.visibleInFilterBar&&i.partOfCurrentVariant;}).filter(function(i){return["PaymentRequest","EditState"].indexOf(i.name)===-1;}).filter(function(i){if(this.appMode().getAppMode()==="request"){return i.name!=="CreatedByUser";}else{return true;}}.bind(this));return f;};b.prototype.createFilterFromFields=function(f){var m=this.getSelectedItem().getModel();var c=this.getSelectedItem().getBindingContext();var d=f.map(function(i){var v=m.getProperty(i.name,c);return{fieldName:i.name,fieldLabel:this.getFieldLabel(i.name),value:this.formatValue(i.name,v),rawValue:this.getRawValue(i.name,v)};}.bind(this));return d;};b.prototype.onDuplicateCheckOK=function(){var s=this.view().byId("listReportFilter");var l=this.view().byId("duplicateCheckList").getSelectedItems();var f={};l.forEach(function(i){var c=i.data("fieldName");f[c]=this.createFilterItem(i);}.bind(this));f=this.handleAppModeRequestFilter(f);s.clear();s.setFilterData(f,true);this.closeDialog();s.search();};b.prototype.handleAppModeRequestFilter=function(f){var s=this.view().byId("listReportFilter");var c=s.getFilterData();if(s.getControlByKey("CreatedByUser").getEditable()===false&&c.CreatedByUser!==undefined){f.CreatedByUser=c.CreatedByUser;}return f;};b.prototype.getFieldLabel=function(f){var s=this.view().byId("listReportFilter");var c=s.getControlByKey(f);var l=c.getLabels()[0];return l.getText();};b.prototype.getAvailablePaymentStatuses=function(){var s=this.view().byId("listReportFilter");var c=s.getControlByKey("StatusCode");var d=c.getAggregation("items").map(function(i){return{key:i.getProperty("key"),text:i.getProperty("text")};});return d;};b.prototype.formatValue=function(i,v){var f;var s;if(v instanceof Date){f=v.toLocaleDateString();}else if(i==="StatusCode"){s=this.getAvailablePaymentStatuses();f=s.filter(function(c){return c.key===v;}).map(function(c){return c.text;})[0];}else{f=v;}return f;};b.prototype.getRawValue=function(i,v){var r;var s;if(i==="StatusCode"){s=this.getAvailablePaymentStatuses();r=s.filter(function(c){return c.key===v;});}else{r=v;}return r;};b.prototype.createFilterItem=function(i){var f;var r=i.data("rawValue");var c=i.data("fieldName");if(c==="StatusCode"){f={items:[r[0]]};}else if(r instanceof Date===true){f={ranges:[{operation:F.BT,value1:r,value2:r}]};}else{f=i.getInfo();}return f;};b.prototype.getSelectedItem=function(){var t=this.view().byId("listReport").getTable();return t.getSelectedItem();};b.prototype.showDialog=function(){this.fragment().open();};b.prototype.onDuplicateCheckCancel=function(){this.closeDialog();};b.prototype.closeDialog=function(){this.fragment().close();};return b;});

/*
 * Copyright (C) 2009-2019 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/ui/base/Object","fin/ap/process/payments/model/additionalModels","fin/ap/process/payments/lib/Constants","fin/ap/process/payments/lib/Formatters"],function(P,a,C,F){"use strict";var b=P.extend("fin.ap.process.payments.ext.controller.CopyPaymentRequest",{constructor:function(c){this.controller=function(){return c;};this.formatter=F;this.initialize();}});b.prototype.initialize=function(){this.initModel();this.registerItems();this.initCopyBtnVisibility();this.attachObjectPageListener();this.bindCopyButton();};b.prototype.onCopyBtnPress=function(){var c=this.controller().getOwnerComponent().getEventingParent().getModel("copyModel");var d=c.getProperty("/addEntryBtn");c.setProperty("/copyBtnPressed",true);d.firePress();};b.prototype.initModel=function(){var p=this.controller().getOwnerComponent().getEventingParent();var c=p.getModel("copyModel");var m=a.copyModel();if(!c){p.setModel(m,"copyModel");c=m;}this.controller().getView().setModel(c,"copyModel");};b.prototype.registerItems=function(){var c=this.controller().getOwnerComponent().getEventingParent().getModel("copyModel");var i={addEntryBtn:this.controller().byId("addEntry"),listReport:this.controller().byId("listReport"),copyBtnPressed:false,copyBtnEnabled:true};Object.keys(i).forEach(function(k){if(i[k]!==undefined){c.setProperty("/"+k,i[k]);}});};b.prototype.copySelectedRow=function(o){var p=o.getPath();var m=o.getModel();var n=this.createNewRow();Object.keys(n).forEach(function(r){m.setProperty(p+"/"+r,n[r]);});m.submitChanges();};b.prototype.createNewRow=function(){var s=this.getSelectedRowData();this.removeUnavailableProperties(s);s.StatusCode="";s.CreatedByUser="";s.LastChangedByUser="";s.AccountingDocument="";s.ClearingAccountingDocument="";return s;};b.prototype.attachObjectPageListener=function(){if(this.controller().extensionAPI.hasOwnProperty("attachPageDataLoaded")){this.controller().extensionAPI.attachPageDataLoaded(this.onPageDataLoaded.bind(this));}};b.prototype.onPageDataLoaded=function(r){var m=r.context.getModel();var c=this.controller().getOwnerComponent().getEventingParent().getModel("copyModel");var d=c.getProperty("/copyBtnPressed");var i=this.isCreatePage();if(!i){this.controller().getView().getModel("copyModel").setProperty("/copyBtnEnabled",C.PAYMENT_REQUEST_TYPES.some(function(e){return e.code===m.getProperty("PaymentRequestType",r.context);}));}if(!i&&!d){c.setProperty("/rowContext",r?r.context:undefined);}if(d&&i){this.copySelectedRow(r.context);}c.setProperty("/copyBtnPressed",false);};b.prototype.isCreatePage=function(){var c=this.controller().getOwnerComponent().getEventingParent().getModel("btnModel");var u=this.controller().getOwnerComponent().getEventingParent().getModel("uiDetail");return c.getProperty("/isDetailPage")&&u.getProperty("/createMode")&&u.getProperty("/editable");};b.prototype.removeUnavailableProperties=function(d){C.COPY_EXCLUDED_FLDS.forEach(function(p){delete d[p];});};b.prototype.initCopyBtnVisibility=function(){var i=this.isDetailPage();var c=this.getCopyButtons();if(this.isCopyBtnInitialized!==true){Object.keys(c).forEach(function(k){if(c[k]!==undefined){c[k].setVisible(i);}});this.isCopyBtnInitialized=true;}};b.prototype.bindCopyButton=function(){var c=this.getCopyButtons();var u=this.getCurrentUiModelName();Object.keys(c).forEach(function(k){if(c[k]!==undefined){c[k].bindProperty("visible",{parts:[{path:u+">/createMode"},{path:u+">/editable"},{path:"btnModel>/isDetailPage"}],formatter:this.formatter.isCopyBtnVisible});c[k].bindProperty("enabled",{path:"copyModel>/copyBtnEnabled"});}}.bind(this));this.isCopyBtnInitialized=true;};b.prototype.getCopyButtons=function(){return{listReportCopyBtn:this.controller().byId("CopyActionListReport"),objectPageCopyBtn:this.controller().byId("action::CopyActionObjectPage")};};b.prototype.getCurrentUiModelName=function(){var c=this.getCopyButtons();return c.listReportCopyBtn?"uiDetail":"ui";};b.prototype.isDetailPage=function(){var c=this.controller().getOwnerComponent().getEventingParent().getModel("btnModel");return c.getProperty("/isDetailPage");};b.prototype.getSelectedRowData=function(){var c=this.controller().getOwnerComponent().getEventingParent().getModel("copyModel");var l=c.getProperty("/listReport");var s=l.getTable().data("selectedRow");if(!s){s=c.getProperty("/rowContext");}return s?s.getObject():{};};return b;});
